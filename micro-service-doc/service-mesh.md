## Service Mesh
屏蔽服务化架构中，服务治理的细节，让服务治理的策略在多语言之间复用

Service Mesh 主要处理服务之间的通信，它的主要实现形式就是在应用程序同主机上部署一个代理程序，一般将这个代理程序称为 Sidecar

客户端将数据包先发送给，与自身同主机部署的 Sidecar，在 Sidecar 中经过服务发现、负载均衡、服务路由、流量控制之后，再将数据发往指定服务节点的 Sidecar，在服务节点的 Sidecar 中，经过记录访问日志、记录分布式追踪日志、限流之 后，再将数据发送给服务端

这种方式，可以把业务代码和服务治理的策略隔离开，将服务治理策略下沉，让它成为独立的基础模块。这样一来，不仅可以实现跨语言，服务治理策略的复用，还能对这些 Sidecar 做统一的管理


## 流量转发
在 Service Mesh 的实现中，需要无感知地引入 Sidecar 作为网络代理，无论是数据流入还是数据流出时，都要将数据包重定向到 Sidecar 的端口上

### iptables
iptables 方式对于业务完全透明，业务甚至不知道有 Sidecar 存在，这样会减少业务接入的时间。但是，在高并发下，性能上会有损耗

### 轻量级客户端
客户端会通过配置的方式，知道 Sidecar 的部署端口，然后通过一个轻量级客户端，将调用服务的请求发送给 Sidecar，Sidecar 在转发请求之前，先执行一些服务治理的策略，比如说，从注册中心中，查询到服务节点信息并且缓存起来，然后从服务节点中，使用某种负载均衡的策略选出一个节点等等

请求被发送到服务端的 Sidecar 上后，然后在服务端记录访问日志，和分布式追踪日志，再把请求转发到真正的服务节点上

服务节点在启动时，会委托服务端 Sidecar，向注册中心注册节点。Sidecar 也就知道了真正服务节点部署的端口是多少