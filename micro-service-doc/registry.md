## 服务发现
### 客户端
配置在客户端的代码中

缺点：
1. 在紧急扩容的时候，需要修改客户端配置后，重启所有的客户端进程，操作时间比较长
2. 一旦某一个服务器出现故障时，需要修改所有客户端配置后重启，无法快速修复，更无法做到自动恢复
3. 服务端上线无法做到提前摘除流量，这样在重启服务端的时候，客户端发往被重启服务端的请求还没有返回，会造成慢请求甚至请求失败

### 注册中心
注册中心的基本功能有两点：
1. 提供服务地址的存储
2. 当存储内容发生变化时，可以将变更的内容推送给客户端

完整的服务注册和发现过程：
1. 客户端会与注册中心建立连接，并且告诉注册中心，它对哪一组服务感兴趣
2. 服务端向注册中心注册服务后，注册中心会将最新的服务注册信息通知给客户端
3. 客户端拿到服务端的地址之后就可以向服务端发起调用请求了

有了注册中心之后，服务节点的增加和减少对于客户端就是透明的。除了可以实现不重启客户端，就能动态地变更服务节点以外，还可以实现优雅关闭的功能


## 服务状态管理
服务的上线和下线是由服务端主动向注册中心注册、和取消注册来实现的，这在正常的流程中是没有问题的。可是，如果某一个服务端意外故障，比如说机器掉电，网络不通等情况，服务端就没有办法向注册中心通信，将自己从服务列表中删除，那么客户端也就不会得到通知，它就会继续向一个故障的服务端发起请求，也就会有错误发生了

一般会有两种解决思路：
1. 主动探测。服务打开一个端口，由注册中心每隔一段时间探测这些端口是否可用，如果可用就认为服务仍然是正常的，否则就可以认为服务不可用，注册中心就可以把服务从列表里面删除

这种方式有两个问题：
第一个问题是：所有的服务端都需要开放一个统一的端口给注册中心探测，在没有容器化的情况下，如果一台物理机上混合部署很多的服务，需要开放的端口很可能已经被占用，这样会造成服务启动失败

第二个问题是：如果服务端部署的实例比较多，那么每次探测的成本也会比较高，探测的时间也比较长，这样当一个服务不可用时，可能会有一段时间的延迟，才会被注册中心探测到

2. 心跳模式。注册中心为每一个连接上来的服务节点，记录最近续约的时间。服务节点在注册之后，就按照一定的时间间隔，向注册中心发送心跳包。注册中心在接受到心跳包之后，会更新这个节点的最近续约时间。然后，注册中心会启动一个定时器，定期检测当前时间和节点，最近续约时间的差值，如果达到一个阈值，那么认为这个服务节点不可用


## 通知风暴
如果多个服务集群同时上线或者发生波动时，注册中心推送的消息就会更多，会严重占用机器的带宽资源

有以下解决思路：
1. 控制一组注册中心管理的服务集群的规模，主要考察的指标就是注册中心服务器的峰值带宽
2. 通过扩容注册中心节点的方式来解决
3. 规范对于注册中心的使用方式，如果只是变更某一个节点，那么只需要通知这个节点的变更信息即可
4. 如果是自建的注册中心，可以在其中加入一些保护策略，比如说如果通知的消息量达到某一个阈值就停止变更通知


## 服务治理
### 服务的注册和发现

### 服务的监控

### 熔断以及引流

### 分布式追踪

### 负载均衡

